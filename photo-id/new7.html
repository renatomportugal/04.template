<!DOCTYPE html>
<html>
<head>
<style>

body{
    margin: 0px;
}

</style>
</head>
<body onload="inicio()">
    <script src="js/jquery-3.1.0.min.js"></script>
    <!-- Draggable -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
$(document).ready(function(){

});

       </script>


    

<script>
    function inicio(){

        function minhaFuncao(codigo) {
            console.log(codigo)
            // Tecla e aumenta 1 px no width.
            if (codigo == 69) {
                var quadroCanvas = document.getElementById("quadrocanvas_0")
                var strwidth = quadroCanvas.style["width"]
                var valor_width = parseInt(strwidth.substr(0, strwidth.length - 2));
                valor_width = valor_width + 1;
                quadroCanvas.style["width"] = valor_width + "px";
            }

            // Tecla Q diminui 1 px no width.
            if (codigo == 81) {
                var quadroCanvas = document.getElementById("quadrocanvas_0")
                var strwidth = quadroCanvas.style["width"]
                var valor_width = parseInt(strwidth.substr(0, strwidth.length - 2));
                valor_width = valor_width - 1;
                quadroCanvas.style["width"] = valor_width + "px";
            }

            // Tecla f aumenta 1 px no height.
            if (codigo == 70) {
                var quadroCanvas = document.getElementById("quadrocanvas_0")
                var strheight = quadroCanvas.style["height"]
                var valor_height = parseInt(strheight.substr(0, strheight.length - 2));
                valor_height = valor_height + 1;
                quadroCanvas.style["height"] = valor_height + "px";
            }

            // Tecla r diminui 1 px no height.
            if (codigo == 82) {
                var quadroCanvas = document.getElementById("quadrocanvas_0")
                var strheight = quadroCanvas.style["height"]
                var valor_height = parseInt(strheight.substr(0, strheight.length - 2));
                valor_height = valor_height - 1;
                quadroCanvas.style["height"] = valor_height + "px";
            }

            
        }
        document.addEventListener('keydown', function(e) {
            e = e || window.event;
            var code = e.which || e.keyCode;
            minhaFuncao(code);
        });





        

        $('#img').mousemove(function(e){
            var x = e.pageX - this.offsetLeft;
            var y = e.pageY - this.offsetTop;
            // console.log("X: " + x + " Y: " + y); 
        });


        $.ajax({
          url: "new7.txt",
          dataType: "text",
          success: function (data) {
            montarTela(data);
            $("#quadrodiv_0").draggable({
                stop: function() {
                    var quadro = document.getElementById("quadrodiv_0")
                    console.log("Top: "+quadro.offsetTop+", Left: "+quadro.offsetLeft)
                }
            });
          },
        });

    function montarTela(data) {
        var gg;
            try {
                if (data != null) {
                    var imagens = JSON.parse(data);

                    for (let i = 0; i < imagens.length; i++) {
                        let imagem = imagens[i];
                        //Extrair o array quadros
                        for (let j = 0; j < imagem.quadros.length; j++) {
                            const quadro = imagem.quadros[j];

                            console.log(quadro);
                            
                            //Cria a div
                            var quadrodiv = document.createElement("div");
                            var id_div = "quadrodiv_" + j;
                            quadrodiv.setAttribute("id", id_div);
                            if (quadro.link != "") {
                                quadrodiv.setAttribute("onclick", "window.open('" + quadro.link + "','_blank')" );    
                            }
                            quadrodiv.setAttribute("onmouseover", "this.style.cursor='pointer';");
                            quadrodiv.setAttribute("style", "position: absolute;z-index: 30;top: " + quadro.top + ";left: " + quadro.left + ";border: " + quadro.border + ";");

                            //$( "#quadrodiv_0" ).draggable();
                            
                            //Cria o Canvas
                            var quadrocanvas = document.createElement("canvas");
                            var quadrocanvastexto = document.createTextNode("Use o Google Chrome.");
                            quadrocanvas.appendChild(quadrocanvastexto);
                            var id_canvas = "quadrocanvas_" + j;
                            quadrocanvas.setAttribute("id", id_canvas);
                            quadrocanvas.setAttribute("style", "width: " + quadro.width + ";height: " + quadro.height + ";");
                            //Adiciona div na div image_wrapper
                            document.getElementById("image_wrapper").appendChild(quadrodiv);
                            document.getElementById(id_div).appendChild(quadrocanvas);
                        }

                        //Prepara o espaÃ§o
                        var imagemdiv = document.getElementById("imagemdiv");
                        imagemdiv.style="display: contents; width: " + imagem.width + "; height: " + imagem.height + ";";

                        //Carrega a imagem
                        var img = document.getElementById("img");
                        img.src = imagem.src;
                    }    
                }else{
                    console.log("Nada foi recebido.");
                }
            } catch (error) {
                console.log(error);
            }
        }
    }

</script>

    <div id="image_wrapper">
        <div id="imagemdiv">
            <img id="img" />
        </div>
    </div>

</body>
</html>
